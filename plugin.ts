//minified test-style-ids.json
const json = '{"lexiconTextIds":[{"key":"10regular","textStyleId":"S:e48e921ec6d452b30bebb5cfbeb6e57dffd936ec,2524:4"},{"key":"10semiBold","textStyleId":"S:e0e567e8c5d144f09d87f9baadecb593fa260f88,2524:3"},{"key":"10bold","textStyleId":"S:b81b356136d27af304ad23b26bb321f87c9546a1,2524:37"},{"key":"12regular","textStyleId":"S:8d62b0a9865a92b5b4929aae20029680f133fa84,2536:1"},{"key":"12semiBold","textStyleId":"S:72ce0d0d5dd17989afaaf02432c20bd62269504c,2524:6"},{"key":"12bold","textStyleId":"S:1130d0f55bb4c4d228ef036a12f0833b7a45fda8,2524:38"},{"key":"14regular","textStyleId":"S:3a96b1795e4219433b0cc93d3c07b2dd849b6871,2524:10"},{"key":"14semiBold","textStyleId":"S:83860da3fb6b6f1f0fad67a836eabc0af5fdf21f,2524:11"},{"key":"14bold","textStyleId":"S:a14ae38fca7c09ae11495e2bc3bd9b70816323b2,2524:39"},{"key":"16regular","textStyleId":"S:85e04360a763bead4aed01687d593019bfff6f52,2524:40"},{"key":"16semiBold","textStyleId":"S:4961216cfd61dc9d72f63a0dc566526321af4c7f,2524:14"},{"key":"16bold","textStyleId":"S:808a54bdd2014d5f39c67115d78f4adac8fdb955,2524:13"},{"key":"18regular","textStyleId":"S:8acee069ee5ea60835e3eb0b8d381153f7efd12e,2524:41"},{"key":"18semiBold","textStyleId":"S:154b58f6b504e8f4ce883f4b19425a5844719c37,2524:17"},{"key":"18bold","textStyleId":"S:8084bcb641fe62f06a2fa6ec7842c5b45048e919,2524:16"},{"key":"20regular","textStyleId":"S:86ca8dbd26f1fee639a0b2d42d9fad3b9a35d065,2524:42"},{"key":"20semiBold","textStyleId":"S:32e30aa6ae4b4ef1bd421fd345756c29ea35f5b3,2524:20"},{"key":"20bold","textStyleId":"S:63987de2552075c286d14f756aea5aaf0928a1e6,2524:19"},{"key":"24regular","textStyleId":"S:3d89d2eb283fea1ec26c2e4371c1d773e43a9dd6,2524:43"},{"key":"24semiBold","textStyleId":"S:4a0da6cdd91dc94747a9cdff9e2f046bde951fb9,2524:23"},{"key":"24bold","textStyleId":"S:62f21371e0840f1e8c08ddb3a43b0c4e492a0975,2524:22"},{"key":"28regular","textStyleId":"S:f2f1ea4a582094bfb1f5d60af1e13f510fd71c10,2524:44"},{"key":"28semiBold","textStyleId":"S:5ff4ac34554a0e0f86b1b261f8ce3706c104bdab,2524:26"},{"key":"28bold","textStyleId":"S:089db01c090da6a03ee76dbe61e43c9bcef9bf26,2524:27"},{"key":"32regular","textStyleId":"S:d554b3d1f264860d0c965a514242a105283c0653,2524:45"},{"key":"32semiBold","textStyleId":"S:67347c8378241e387f5a5498bb86ea02ab039217,2524:29"},{"key":"32bold:","textStyleId":"S:dfedcefbfd00535eb86c10b32c309629375b6359,2524:28"},{"key":"36regular","textStyleId":"S:b89ad3f3711866d26c87c994366ca9e23ecca0a2,2524:46"},{"key":"36semiBold","textStyleId":"S:16d7452ab0d64f3c1ac60cda3f80f7d37b569a1d,2524:32"},{"key":"36bold","textStyleId":"S:1c2ef92a9692b704b77ae808b4aaa3c898b5ef5c,2524:31"},{"key":"40regular","textStyleId":"S:9a8e9e30ec1c16a02370c730e7ea574f6aff754c,2524:47"},{"key":"40semiBold","textStyleId":"S:b595828cd11e0c4d20bcb8705730e362d37bc4f0,2524:35"},{"key":"40bold","textStyleId":"S:a0c95321cf89084635dba7040b45b08e0019df8a,2524:34"}],"acTextIds":[{"key":"10regular","textStyleId":"S:1d1a8aed08eb21628efc517b844893c1b367b3ba,817:3"},{"key":"10semiBold","textStyleId":"S:5016b5eef2d4a4c8adca7db92124f7d60b366b59,817:25"},{"key":"10bold","textStyleId":"S:0c263e74abc333b7a2c8258af7426da5dbad87d7,817:47"},{"key":"12regular","textStyleId":"S:3f7b6a23ce8fca7805bb84ad23f81086d1f6d8d9,817:5"},{"key":"12semiBold","textStyleId":"S:b94e10f05b96e4d639705565c9064889a0419a95,817:27"},{"key":"12bold","textStyleId":"S:ed9cc6cf9cd4c8c5406814e85264587bf90cf132,817:49"},{"key":"14regular","textStyleId":"S:67783b51e080274086e589ca24c813d22818b224,817:7"},{"key":"14semiBold","textStyleId":"S:f1fb6126286070d7239385fe3af76c70acc2d223,817:29"},{"key":"14bold","textStyleId":"S:d950792cc1163811f563a1f4ec2366cc015b5e8e,817:51"},{"key":"16regular","textStyleId":"S:31203c46d4585448dce8cb00e68eb13c6bb475d4,817:53"},{"key":"16semiBold","textStyleId":"S:76439577b12dbf9680beba666bb90abff16ace95,817:31"},{"key":"16bold","textStyleId":"S:e0cb5418fb88ad5c8af5400b564f36700c58e010,817:9"},{"key":"18regular","textStyleId":"S:f309e19cab3403dc82f1b9e5e9645bf05cbd38c5,817:55"},{"key":"18semiBold","textStyleId":"S:33c0bc704148fff39a3421c27f94f2f5ae0b0a8b,817:33"},{"key":"18bold","textStyleId":"S:67b4f08e9f324fe3bd0a3c8c6fbc79e56f9fca3a,817:11"},{"key":"20regular","textStyleId":"S:5ba5b248585de2505e408922dc7c54b5beb5901c,817:57"},{"key":"20semiBold","textStyleId":"S:32e30aa6ae4b4ef1bd421fd345756c29ea35f5b3,2524:20"},{"key":"20bold","textStyleId":"S:cba108fe0e06da2ee12e8069cc001692fc043de0,817:13"},{"key":"24regular","textStyleId":"S:9cc7de53648cda1c1c4ad2b42d4986c4a6f52070,817:59"},{"key":"24semiBold","textStyleId":"S:52bf04df4e9d4029d9d9bea16553e119411eed50,817:37"},{"key":"24bold","textStyleId":"S:2b261c1e36e3eb18490c220fc1e6213e309de8bb,817:15"},{"key":"28regular","textStyleId":"S:e373bdbddfaf4207f0af0b810825171ad0e40f47,817:61"},{"key":"28semiBold","textStyleId":"S:473bee5e59d5fea8c03b8dfd14880e50b615d301,817:39"},{"key":"28bold","textStyleId":"S:c5d6b9c3d16387aedee4e51188335f2ed3fa8376,817:17"},{"key":"32regular","textStyleId":"S:8f388dd91ac87d380d0ebfe1bbf8dab2657b0f9b,817:63"},{"key":"32semiBold","textStyleId":"S:0cd647dd4ec165b276de0564cf6638944e7974c8,817:41"},{"key":"32bold:","textStyleId":"S:f860c1d69adb4c74ec4b82fb220ffe3b8d71b3db,817:19"},{"key":"36regular","textStyleId":"S:01e7a7def8d442a28dd2f7870c6451b3c1140c1a,817:65"},{"key":"36semiBold","textStyleId":"S:71e2d5b03798ca372946c0f1e507327014c6ec5a,817:43"},{"key":"36bold","textStyleId":"S:a1d3ea3d650e4f40e4b2143833830a5db348494f,817:21"},{"key":"40regular","textStyleId":"S:94b2b1ce10eca063c4ded392ba6877d098de60d5,817:67"},{"key":"40semiBold","textStyleId":"S:6c3f18ceda56a2eb33311e6196ec989beab9d1fe,817:45"},{"key":"40bold","textStyleId":"S:aed3efa38283145574bc0dfcee95cd21bb300869,817:23"}]}'
//parse json to use as obj
const textStyleIds = JSON.parse(json);

figma.loadFontAsync({ family: "SF Pro Text", style: "Regular" });
figma.loadFontAsync({ family: "SF Pro Text", style: "Semibold" });
figma.loadFontAsync({ family: "SF Pro Text", style: "Bold" });
figma.loadFontAsync({ family: "Source Sans Pro", style: "Regular" });
figma.loadFontAsync({ family: "Source Sans Pro", style: "Semibold" });
figma.loadFontAsync({ family: "Source Sans Pro", style: "SemiBold" });
figma.loadFontAsync({ family: "Source Sans Pro", style: "Bold" });

figma.showUI(__html__, {width:270, height:340});

let textStyleMapLexiconToAc = new Map();
let textStyleMapAcToLexicon = new Map();
let totalIds = textStyleIds.lexiconTextIds.length

for (var i = 0; i < totalIds; i++) {
  let lexiconTextId = textStyleIds.lexiconTextIds[i];
  let acTextId = textStyleIds.acTextIds[i];

  // Map lexicon style ids to corresponding ac style ids
  if (lexiconTextId.key === acTextId.key) {
    textStyleMapLexiconToAc.set(lexiconTextId.textStyleId, acTextId.textStyleId);
  } else {
    console.error("Text style key mismatch:" + lexiconTextId.key + ", " + acTextId.key); 
  }

  if (acTextId.key === lexiconTextId.key) {
    textStyleMapAcToLexicon.set(acTextId.textStyleId, lexiconTextId.textStyleId);
  } else {
    console.error("Text style key mismatch:" + acTextId.key + ", " + lexiconTextId.key); 
  }
}

function changeFontToAc() {
  const nodes = figma.currentPage.selection
  changeTextStyleForNodesToAc(nodes);
  console.log("Selected Font Changed to Source Sans");
  figma.ui.postMessage("Selected Font Changed to Source Sans");
  // figma.closePlugin()
}

function changeFontToAcPage() {
  const nodes = figma.currentPage.findAll(node => node.type === "TEXT");
  changeTextStyleForNodesToAc(nodes);
  console.log("Page Font Changed to Source Sans");
  figma.ui.postMessage("Page Font Changed to Source Sans");
  // figma.closePlugin()
}

function changeTextStyleForNodesToAc(nodes) {
  for (const node of nodes) {
    if ("textStyleId" in node) {
      if (textStyleMapLexiconToAc.has(node.textStyleId)) {
        node.textStyleId = textStyleMapLexiconToAc.get(node.textStyleId)
      } else {
        console.warn("Missing corresponding text style id")
        console.log(node.textStyleId);
      }
    }
  }
}

function changeFontToLexicon() {
  const nodes = figma.currentPage.selection
  changeTextStyleForNodesToLexicon(nodes);
  console.log("Selected Font Changed to System");
  figma.ui.postMessage("Selected Font Changed to Source Sans");
  // figma.closePlugin()
}

function changeFontToLexiconPage() {
  const nodes = figma.currentPage.findAll(node => node.type === "TEXT");
  changeTextStyleForNodesToLexicon(nodes);
  console.log("Page Font Changed to System");
  figma.ui.postMessage("Page Font Changed to Source Sans");
  // figma.closePlugin()
}

function changeTextStyleForNodesToLexicon(nodes) {
  for (const node of nodes) {
    if ("textStyleId" in node) {
      if (textStyleMapAcToLexicon.has(node.textStyleId)) {
        node.textStyleId = textStyleMapAcToLexicon.get(node.textStyleId)
      } else {
        console.warn("Missing corresponding text style id")
        console.log(node.textStyleId);
      }
    }
  }
}

figma.ui.onmessage = msg => {
  if (msg.type === "change-font-to-ac") {
    changeFontToAc();
  }
  if (msg.type === "change-font-to-ac-page") {
    changeFontToAcPage();
  }
  if (msg.type === "change-font-to-lexicon") {
    changeFontToLexicon();
  }
  if (msg.type === "change-font-to-lexicon-page") {
    changeFontToLexiconPage();
  }
  if (msg.type === "cancel") {
    figma.closePlugin();
  }
};
